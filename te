-- ===== Setup =====
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local PlayerName = LocalPlayer.Name
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")
local HttpService = game:GetService("HttpService")

-- ===== Discord Webhook URL =====
local WEBHOOK_URL = "https://discord.com/api/webhooks/WEBHOOK_ID/WEBHOOK_TOKEN" -- ganti dengan webhook lo

-- ===== Function kirim ke Discord =====
local function sendToDiscord(text)
    local req = (http_request or request or syn.request)
    if req then
        req({
            Url = WEBHOOK_URL,
            Method = "POST",
            Headers = {["Content-Type"]="application/json"},
            Body = HttpService:JSONEncode({content=text})
        })
    else
        warn("No HTTP request function available!")
    end
end

-- ===== Function untuk notifikasi lokal =====
local enablePopup = false -- set ke false kalau AFK
local function NotifyLocal(message)
    if not enablePopup then return end

    -- Print ke console
    print("⚡ Mention detected: " .. message)

    -- Sound notifikasi
    local sound = Instance.new("Sound")
    sound.SoundId = "rbxassetid://138087587" -- contoh sound
    sound.Volume = 1
    sound.Parent = workspace
    sound:Play()

    -- GUI popup
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "MentionPopup"
    screenGui.Parent = PlayerGui

    local textLabel = Instance.new("TextLabel")
    textLabel.Size = UDim2.new(0, 300, 0, 50)
    textLabel.Position = UDim2.new(0.5, -150, 0.1, 0)
    textLabel.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
    textLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    textLabel.Font = Enum.Font.SourceSansBold
    textLabel.TextSize = 24
    textLabel.Text = "⚡ Mentioned: " .. message
    textLabel.Parent = screenGui

    -- Hapus popup setelah 3 detik
    delay(3, function()
        screenGui:Destroy()
        sound:Destroy()
    end)
end

-- ===== Gabung notifikasi =====
local function Notify(senderName, message)
    NotifyLocal(message)
    sendToDiscord("Mention detected in Roblox!\nPlayer: " .. senderName .. "\nMessage: " .. message)
end

-- ===== Monitor RemoteEvent chat (jika ada) =====
local chatRemote = ReplicatedStorage:FindFirstChild("Remotes") and ReplicatedStorage.Remotes:FindFirstChild("ChatMessage")
if chatRemote then
    chatRemote.OnClientEvent:Connect(function(sender, message)
        if message:lower():find(PlayerName:lower()) then
            Notify(sender.Name, message)
        end
    end)
end

-- ===== Monitor semua TextLabel di GUI =====
local function monitorGui(gui)
    gui.DescendantAdded:Connect(function(child)
        if child:IsA("TextLabel") then
            -- Debug print
            print("Detected TextLabel: " .. child.Text)
            if child.Text:lower():find(PlayerName:lower()) then
                Notify("Unknown (GUI)", child.Text)
            end
        end
    end)
end

-- Scan semua ScreenGui di PlayerGui
for _, gui in pairs(PlayerGui:GetChildren()) do
    if gui:IsA("ScreenGui") then
        monitorGui(gui)
    end
end

-- Tambah listener untuk ScreenGui baru yang muncul
PlayerGui.ChildAdded:Connect(function(gui)
    if gui:IsA("ScreenGui") then
        monitorGui(gui)
    end
end)

print("✅ AFK-ready mention monitor active for player: " .. PlayerName)
