--// Config
local WEBHOOK_URL = "https://discord.com/api/webhooks/1408626413787025428/ZvfH7T2noVocf4UoESq66gOMU9bRoJw9-k77DdsUkSjjLJdgdqtjYLmQa5oJhgfjMmFU" -- ganti webhook

local HttpService = game:GetService("HttpService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")

-- Exclude list (pakai full path string biar gampang cek)
local excludeList = {
    ["Workspace.Purchasable.Delta.Enchanted Sluice"] = true,
    ["Workspace.Purchasable.RiverTown.Merchant's Potion"] = true
    ["Workspace.Purchasable.RiverTown.Merchant's Potion"] = true,
    ["Workspace.Purchasable.StarterTown"] = true,
    ["Workspace.Purchasable.RiverTown"] = true,
    ["Workspace.Purchasable.Delta"] = true,
    ["Workspace.Purchasable.Cavern"] = true,
    ["Workspace.Purchasable.Frozen Peak"] = true,
    ["Workspace.Purchasable.Volcano"] = true
}

-- fungsi kirim ke discord
local function sendToDiscord(location, childrenList)
    local req = (http_request or request or syn.request)
    if not req then
        warn("Exploit environment tidak support http_request")
        return
    end

    -- format list ke bentuk nomor
    local stockLines = {}
    for i, item in ipairs(childrenList) do
        table.insert(stockLines, i .. ". " .. item)
    end

    local content = "Trader Location : " .. location .. "\n\nStocks :\n" .. table.concat(stockLines, "\n")

    local data = {
        content = content
    }

    req({
        Url = WEBHOOK_URL,
        Method = "POST",
        Headers = {["Content-Type"] = "application/json"},
        Body = HttpService:JSONEncode(data)
    })
end

-- fungsi ambil semua anak langsung kecuali exclude
local function getChildrenList()
    local results = {}

    for _, child in ipairs(Workspace.Purchasable:GetChildren()) do
        local path = child:GetFullName()
        if not excludeList[path] then
            table.insert(results, child.Name) -- cuma kirim nama
        end
    end

    return results
end

-- listen ke Notification event
local notificationEvent = ReplicatedStorage:WaitForChild("Remotes"):WaitForChild("Info"):WaitForChild("Notification")

notificationEvent.OnClientEvent:Connect(function(...)
    local args = {...}
    local message = args[1]

    if typeof(message) == "string" and message:find("The wandering trader has arrived") then
        -- cari lokasi setelah kata "at"
        local location = message:match("at (.+)!")
        if not location then
            location = "Unknown"
        end

        local children = getChildrenList()
        sendToDiscord(location, children)
        task.delay(15, function()
            local children = getChildrenList()
            sendToDiscord(location, children)
        end)
    end
end)
