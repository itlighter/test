local ReplicatedStorage = game:GetService("ReplicatedStorage")
local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

-- Webhook config
local WEBHOOK_URL = "https://discord.com/api/webhooks/1406862075988545658/a7sM5kebE9xUS_CNlWrPlwMOI-PLY3pZmKltgjfrsy4239Ee-RKLXYuX33DUWMGkby74"
local Request = syn and syn.request or http_request or request or nil
local function sendToDiscord(content)
    if not Request then return end
    Request({
        Url = WEBHOOK_URL,
        Method = "POST",
        Headers = { ["Content-Type"] = "application/json" },
        Body = HttpService:JSONEncode({ content = content })
    })
end

-- Blacklist full path
local blacklist = {
    ["ReplicatedStorage.Remotes.Misc.SystemMessage"] = true,
    ["ReplicatedStorage.Modules.Utility.TweenServicePlus.TweenCommunication"] = true,
    ["ReplicatedStorage.Modules.Utility.TweenServicePlus.SyncedTime.TimeSyncEvent"] = true
}

-- Helper function untuk cek blacklist
local function isBlacklisted(obj)
    return blacklist[obj:GetFullName()] or false
end

-- Attach listener ke RemoteEvent / RemoteFunction
local function attachListener(obj)
    if isBlacklisted(obj) then return end

    if obj:IsA("RemoteEvent") then
        obj.OnClientEvent:Connect(function(...)
            local args = {...}
            local argStr = {}
            for i,v in ipairs(args) do
                table.insert(argStr, tostring(v))
            end
            local message = string.format("[RemoteEvent Fired] %s -> Args: %s", obj:GetFullName(), table.concat(argStr, ", "))
            print(message)
            sendToDiscord(message)
        end)
    elseif obj:IsA("RemoteFunction") then
        local oldInvoke = obj.InvokeServer
        obj.InvokeServer = function(self, ...)
            local args = {...}
            local message = string.format("[RemoteFunction Invoke] %s -> Args: %s", obj:GetFullName(), table.concat(args, ", "))
            print(message)
            sendToDiscord(message)
            return oldInvoke(self, unpack(args))
        end
    end
end

-- Scan semua descendants di ReplicatedStorage
for _, obj in ipairs(ReplicatedStorage:GetDescendants()) do
    if obj:IsA("RemoteEvent") or obj:IsA("RemoteFunction") then
        attachListener(obj)
    end
end

-- Listener untuk Remote baru yang ditambahkan
ReplicatedStorage.DescendantAdded:Connect(function(obj)
    if obj:IsA("RemoteEvent") or obj:IsA("RemoteFunction") then
        attachListener(obj)
    end
end)

print("Dynamic listener attached (blacklist applied)!")
